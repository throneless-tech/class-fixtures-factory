"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("tinspector"),r=e(t),n=require("tslib"),a=require("class-validator"),o=e(require("faker")),i=e(require("chalk")),s=e(require("treeify")),p=function(e){for(var t=Object.getOwnPropertyNames(e).filter((function(t){return e.propertyIsEnumerable(t)&&t!==String(parseFloat(t))})),r=t.length,n=new Array(r),a=0;a<r;++a)n[a]=e[t[a]];return n},u=function(){function e(){this.store={}}return e.prototype.get=function(e){var t="string"==typeof e?e:e.name,r=this.store[t];if(!r)throw new Error('Cannot find metadata for class "'+t+'"');return r},e}(),c=function(){function e(){this.metadata={}}return e.prototype.extractMedatada=function(e){var t=a.getFromContainer(a.MetadataStorage).getTargetValidationMetadatas(e,"");return this.metadata[e.name]=t},e.prototype.makePropertyMetadata=function(e,t){var r=n.__assign({name:e.propertyName},t||{}),a={type:null,max:null,min:null};switch(e.type){case"isBoolean":return n.__assign(n.__assign({},r),{type:r.type||"boolean",input:function(){return o.random.boolean()}});case"isDate":a.type="date";break;case"isString":a.type="alpha";break;case"isNumber":case"isInt":case"isNumberString":a.type="number";break;case"isIn":var i=e.constraints[0];return n.__assign(n.__assign({},r),{type:r.type||"any",input:function(){return o.random.arrayElement(i)}});case"equals":return n.__assign(n.__assign({},r),{type:r.type||"any",input:function(){return e.constraints[0]}});case"isEmpty":return n.__assign(n.__assign({},r),{type:r.type||"any",input:function(){return null}});case"isPositive":a.type="number",a.min=1;break;case"isNegative":a.type="number",a.max=-1;break;case"min":var s=e.constraints[0];a.type="number",a.min=s;break;case"max":s=e.constraints[0],a.type="number",a.max=s;break;case"minDate":s=e.constraints[0],a.type="date",a.min=s;break;case"maxDate":s=e.constraints[0],a.type="date",a.max=s;break;case"contains":var p=e.constraints[0];return n.__assign(n.__assign({},r),{type:r.type||"any",input:function(){return""+o.random.word()+p+o.random.word()}});case"isAlpha":a.type="alpha";break;case"isAlphanumeric":a.type="alphanumeric";break;case"isDecimal":a.options=e.constraints[0],a.type="decimal";break;case"isEmail":return n.__assign(n.__assign({},r),{type:"string",input:function(){return o.internet.email()}});case"isFqdn":return n.__assign(n.__assign({},r),{type:"string",input:function(){return o.internet.domainName()}});case"isHexColor":return n.__assign(n.__assign({},r),{type:"string",input:function(){return o.internet.color()}});case"isLowercase":a.type="alpha",a.case="lower";break;case"isUppercase":a.type="alpha",a.case="upper";break;case"length":var u=n.__read(e.constraints,2),c=u[1];a.min=m=u[0],a.max=c||6,a.type="alpha";break;case"minLength":a.min=s=e.constraints[0],a.type="alpha";break;case"maxLength":a.max=s=e.constraints[0],a.type="alpha";break;case"arrayContains":var y=e.constraints[0];return n.__assign(n.__assign({},r),{type:"string",input:function(){return y}});case"arrayMinSize":s=e.constraints[0],a.type="array",a.min=s;break;case"arrayMaxSize":s=e.constraints[0],a.type="array",a.max=s}switch("number"!=typeof a.max||a.min?"number"!=typeof a.min||a.max||(a.max=a.min+1):a.min=a.max-1,"number"==typeof a.max&&"number"==typeof a.min&&a.min>a.max&&(a.max=a.min+1),a.type){case"number":var m=a.min,l=(f=(c=a.max)<0?-1:1)*o.random.number({min:Math.abs(m||f),max:Math.abs(c||1e4)});return n.__assign(n.__assign({},r),{type:"number",input:function(){return l}});case"decimal":m=a.min,c=a.max;var f,g=Number(a.options.decimal_digits||"1"),h=(f=c<0?-1:1)*parseFloat(o.finance.amount(Math.abs(m||f),Math.abs(c||1e4),g));return n.__assign(n.__assign({},r),{type:"number",input:function(){return h}});case"date":var d;return c=a.max,d=(m=a.min)?o.date.between(m,c||o.date.future(1,m)):c?o.date.between(m||o.date.past(1,c),c):o.date.recent(),n.__assign(n.__assign({},r),{type:"Date",input:function(){return d}});case"alpha":var _=o.random.number({min:(m=a.min)||5,max:(c=a.max)||10}),v=o.lorem.sentence(100).substr(0,_)["lower"===a.case?"toLowerCase":"toUpperCase"]();return n.__assign(n.__assign({},r),{type:"string",input:function(){return v}});case"alphanumeric":var x=o.random.number({min:(m=a.min)||5,max:(c=a.max)||10});return n.__assign(n.__assign({},r),{type:"string",input:function(){return o.random.alphaNumeric(x)["lower"===a.case?"toLowerCase":"toUpperCase"]()}});case"array":if(!r.type)throw new Error('The type of "'+e.propertyName+'" seems to be an array. Use @Fixture({ type: () => Foo })');return n.__assign(n.__assign({},r),{max:a.max||r.max,min:a.min||r.min})}return r.type?r:null},e}(),y=function(e){function t(t){void 0===t&&(t=!1);var r=e.call(this)||this;return r.acceptPartialResult=t,r.cvAdapter=new c,r}return n.__extends(t,e),t.prototype.make=function(e){var t,a,o=this,i=r(e),s=this.cvAdapter.extractMedatada(e),p=new Set,u=i.properties.map((function(e){return o.makePropertyMetadata(e)})).filter(Boolean),c=function(e){var t=u.find((function(t){return t.name===e.propertyName})),r=y.cvAdapter.makePropertyMetadata(e,t);r?(t?u=u.map((function(n){return n.name===e.propertyName?r:t})):u.push(r),p.delete(e.propertyName)):u.find((function(t){return t.name===e.propertyName&&!!t.type}))||p.add(e.propertyName)},y=this;try{for(var m=n.__values(s),l=m.next();!l.done;l=m.next())c(l.value)}catch(e){t={error:e}}finally{try{l&&!l.done&&(a=m.return)&&a.call(m)}finally{if(t)throw t.error}}if(p.size>0)throw new Error("Couldn't extract the type of "+n.__spread(p).map((function(e){return'"'+e+'"'})).join(", ")+". Use @Fixture({ type: () => Foo })");var f={name:i.name,properties:u.filter(Boolean)};return this.store[e.name]=f},t.prototype.makePropertyMetadata=function(e){var t,r=this.getFixtureDecorator(e),n={name:e.name,scalar:"Primitive"===e.typeClassification};if(r)if("function"==typeof r)n.input=r.bind(r,require("faker"));else if("string"==typeof r)n.input=function(){return r};else if("object"==typeof r){if(r.ignore)return null;n.input=r.get,n.min=r.min||1,n.max=r.max||3,n.optional=r.optional||!1;var a=null===(t=r.type)||void 0===t?void 0:t.call(r);if(a){if(Array.isArray(a)&&(a=a[0],n.array=!0),!a.prototype)throw new Error('Only pass class names to "type" in @Fixture({ type: () => Foo}) for "'+n.name+'"');var o=a.name;n.type=["string","number","boolean"].includes(o.toLowerCase())?o.toLowerCase():o}r.enum&&(n.enum=!0,n.items=p(r.enum))}if(!n.type)if(e.type){if(Array.isArray(e.type))throw new Error('The type of "'+n.name+'" seems to be an array. Use @Fixture({ type: () => Foo })');if(e.type instanceof Function){var i=e.type.name;n.type=["string","number","boolean"].includes(i.toLowerCase())?i.toLowerCase():i}}else if(this.acceptPartialResult)return n;if(!n.type)throw new Error("Couldn't extract the type of \""+n.name+'". Use @Fixture({ type: () => Foo })');return n},t.prototype.getFixtureDecorator=function(e){var t;return(null===(t=e.decorators.find((function(e){return"Fixture"===e.type})))||void 0===t?void 0:t.value)||null},t}(u),m=function(){function e(){this.rootTree={},this.tree={},this.duplicates={}}return e.prototype.start=function(e,t){void 0===t&&(t=0);var r="Generated an instance of "+i.gray('"')+i.cyan(e.name)+i.gray('"')+(t?""+i.gray(" ("+t+")"):"");this.rootTree[r]={},this.tree=this.rootTree[r]},e.prototype.onIgnoreProp=function(e){var t=i.cyan(e.name);this.tree[t]=i.gray("(ignored)")},e.prototype.onCustomProp=function(e){var t=i.cyan(e.name);this.tree[t]=i.gray("(custom value)")},e.prototype.onClassPropDone=function(e,t){var r=i.cyan(e.name);if(this.tree[r]){var n=this.duplicates[e.name]=(this.duplicates[e.name]||0)+1,a=function(t){return"Generated an instance of "+i.gray('"')+i.cyan(e.type)+i.gray('"')+i.gray(" ("+t+")")},o=Object.keys(this.tree[r])[0];1===n&&(this.tree[r][a(n-1)]=this.tree[r][o],delete this.tree[r][o]),this.tree[r][a(n)]=t.rootTree}else this.tree[r]=t.rootTree},e.prototype.onNormalProp=function(e,t){var r=i.cyan(e.name);this.tree[r]=t},e.prototype.onClassValidator=function(e,t){var r=i.cyan(e.name);this.tree[r]=i.gray("class-validator]")+" "+t},e.prototype.onDone=function(e){this.tree[i.green("Done")+" "+i.gray("("+e+"ms)")]=null},e.prototype.onError=function(e){this.tree[i.red("Error")+" "+i.gray("("+e+"ms)")]=null},e.prototype.log=function(){return s.asTree(this.rootTree,!0,!1)},e}(),l=function(){function e(e){this.classTypes={},this.DEFAULT_OPTIONS={logging:!1,maxDepth:4},this.loggers=[],this.assigner=this.defaultAssigner.bind(this),this.store=new y,this.options=n.__assign(n.__assign({},this.DEFAULT_OPTIONS),e||{})}return e.prototype.defaultAssigner=function(e,t,r){t[e.name]=r},e.prototype.setAssigner=function(e){this.assigner=e},e.prototype.setMetadataStore=function(e){this.store=e},e.prototype.getStore=function(){return this.store},e.prototype.log=function(e,t){void 0===t&&(t=!1),(t||this.options.logging)&&console.log(i.gray("[FixtureFactory] "),e)},e.prototype.newLogger=function(e){this.loggers.unshift(new m);var t=this.logger();return t.start(e),t},e.prototype.logger=function(){return this.loggers[0]},e.prototype.printLogger=function(e){void 0===e&&(e=!1);var t=this.logger();t&&(this.log("\n"+t.log()),e&&this.disposeLogger())},e.prototype.disposeLogger=function(){this.loggers.shift()},e.prototype.register=function(e){var t,r;try{for(var a=n.__values(e),o=a.next();!o.done;o=a.next()){var i=o.value;this.store.make(i),this.classTypes[i.name]=i}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}},e.prototype.make=function(e){var t=this;this.store.make(e);var r=this.store.get(e),a=[],o={},s={one:function(){var s,p,u=!1,c={},y=new Date;t.newLogger(r);try{c=t._make(r,e,a);try{for(var m=n.__values(Object.entries(o)),l=m.next();!l.done;l=m.next()){var f=n.__read(l.value,2);c[f[0]]=f[1]}}catch(e){s={error:e}}finally{try{l&&!l.done&&(p=m.return)&&p.call(m)}finally{if(s)throw s.error}}}catch(e){t.log(i.red('An error occured while generating "'+r.name+'"'),!0),console.error(e),u=!0}var g=+new Date-+y;return t.logger()[u?"onError":"onDone"](g),t.printLogger(!0),u?null:c},many:function(e){return n.__spread(Array(e).keys()).map((function(){return s.one()}))},with:function(e){var t,r;o=e;try{for(var i=n.__values(Object.keys(e)),p=i.next();!p.done;p=i.next())a.push(p.value)}catch(e){t={error:e}}finally{try{p&&!p.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return s},ignore:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a=a.concat(e),s}};return s},e.prototype._make=function(e,t,r,a){var o,i;void 0===r&&(r=[]),void 0===a&&(a=0);var s=new t;try{for(var p=n.__values(e.properties),u=p.next();!u.done;u=p.next()){var c=u.value;r.includes(c.name)||this.shouldIgnoreProperty(c)||this.assigner(c,s,this.makeProperty(c,e,a+1))}}catch(e){o={error:e}}finally{try{u&&!u.done&&(i=p.return)&&i.call(p)}finally{if(o)throw o.error}}return s},e.prototype.shouldIgnoreProperty=function(e){return!!e.ignore},e.prototype.makeProperty=function(e,t,r){if(e.input)return this.logger().onCustomProp(e),e.input();if(e.scalar){var n=this.makeScalarProperty(e);return this.logger().onNormalProp(e,n),n}return e.array?this.makeArrayProp(e,t,r):this.makeObjectProp(t,e,r)},e.prototype.makeScalarProperty=function(e){if(e.enum&&e.items)return o.random.arrayElement(e.items);switch(e.type){case"string":return o.random.word();case"number":return o.random.number();case"boolean":return o.random.boolean();case"Date":return o.date.recent()}throw new Error("Can't generate a value for this scalar")},e.prototype.makeArrayProp=function(e,t,r){var a=this,i=o.random.number({max:e.max,min:e.min});return this.options.maxDepth&&r>=this.options.maxDepth?[]:["string","number","boolean","Date"].includes(e.type)?n.__spread(Array(i).keys()).map((function(){return a.makeProperty(n.__assign(n.__assign({},e),{array:!1,scalar:!0}),t,r)})):n.__spread(Array(i).keys()).map((function(){return a.makeProperty(n.__assign(n.__assign({},e),{array:!1}),t,r)}))},e.prototype.makeObjectProp=function(e,t,r){var n,a=this.store.get(t.type),o=this.findRefSideProps(e,t),i=this.logger(),s=this.newLogger(a);return this.options.maxDepth&&this.options.maxDepth&&r>=this.options.maxDepth&&t.optional||(n=this._make(a,this.classTypes[t.type],o.map((function(e){return e.name})),r)),i.onClassPropDone(t,s),this.disposeLogger(),n},e.prototype.findRefSideProps=function(e,t){var r,a,o=[],i=this.store.get(t.type);try{for(var s=n.__values(i.properties),p=s.next();!p.done;p=s.next()){var u=p.value;u.type===e.name&&o.push(u)}}catch(e){r={error:e}}finally{try{p&&!p.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}return o},e}();exports.BaseMetadataStore=u,exports.DefaultMetadataStore=y,exports.FactoryLogger=m,exports.Fixture=function(e){return t.decorateProperty({type:"Fixture",value:e})},exports.FixtureFactory=l,exports.getEnumValues=p;
//# sourceMappingURL=class-fixtures-factory.cjs.production.min.js.map
